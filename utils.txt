utility functuons for version 3